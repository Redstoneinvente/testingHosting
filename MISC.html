<!DOCTYPE html>
<html>
<head>
  <title>Zoom Link</title>
</head>
<body>
  <button id="zoomLinkButton" onclick="getUserInfo()">Link with Zoom</button>
  <div id="userInfo"></div>
</body>

<script>
    const clientId = 'lqhJPDBaTNWD0MStTYxOw'; 
    const redirectUri = 'http://localhost:3000/zoom-auth-callback'; // Must match your Zoom app settings

document.getElementById('zoomAuthButton').addEventListener('click', startZoomOAuth);

function startZoomOAuth() {
  const authUrl = `https://zoom.us/oauth/authorize?response_type=code&client_id=${clientId}&redirect_uri=${redirectUri}`;
  window.location.href = authUrl; 
}

// Handle code returned from Zoom (example using URL query parameters)
function handleAuthorizationCode() {
  const urlParams = new URLSearchParams(window.location.search);
  const code = urlParams.get('code');

  if (code) {
    fetchZoomUserInfo(code);
  }
}

async function fetchZoomUserInfo(code) {
  // Placeholder: Securely exchange code for access token on your backend
  const accessToken = await exchangeCodeForToken(code); 

  fetch('https://api.zoom.us/v2/users/me', {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${accessToken}`
    }
  })
  .then(response => response.json())
  .then(displayUserInfo)
  .catch(error => console.error('Error fetching user info:', error));
}

function displayUserInfo(data) {
  const userInfoDiv = document.getElementById('userInfo');
  userInfoDiv.textContent = `Email: ${data.email}, First Name: ${data.first_name}`;
}

// Placeholder for secure backend exchange of code for access token
async function exchangeCodeForToken(code) {
  // Implement this on your server
  return 'eyJzdiI6IjAwMDAwMSIsImFsZyI6IkhTNTEyIiwidiI6IjIuMCIsImtpZCI6ImFkODI0OWNhLTE4MWQtNGJiNi1hZmNmLWQ1N2MzNWQ2ZmFlMCJ9.eyJhdWQiOiJodHRwczovL29hdXRoLnpvb20udXMiLCJ1aWQiOiJaTDJXVnk5VlQwdThoRDRtb29USF9BIiwidmVyIjo5LCJhdWlkIjoiOWE0MDMzMWFlYWU3MjlmMWMxNzZlODJjYzY0MjZlYmIiLCJuYmYiOjE3MTA2OTEzOTQsImNvZGUiOiI4TEhNYndaTVNKR3M2V0k0WFpoUzF3QmhKSFRrNU9ZcTEiLCJpc3MiOiJ6bTpjaWQ6bHFoSlBEQmFUTldEME1TdFRZeE93IiwiZ25vIjowLCJleHAiOjE3MTA2OTQ5OTQsInR5cGUiOjMsImlhdCI6MTcxMDY5MTM5NCwiYWlkIjoiZlRZdkdZWmNUcUNKTmZDMDAtWXpJdyJ9.sM84Rq50BaWxTSSSAkBKxk3cxiv1UFnH9ZnaLH5aU_zQa637KoRcbKlYpZ9cvO26qZe_EUP7rIMLcy221vZSuA'; 
} 

// On page load, check if redirected back from Zoom with code
handleAuthorizationCode(); 

</script>

</html>
